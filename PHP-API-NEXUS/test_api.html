<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de API - Nexus Astralis</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; white-space: pre-wrap; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; }
        label { display: block; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🌌 Nexus Astralis - Test de API</h1>
        
        <div class="section">
            <h2>1. Test de Registro</h2>
            <form id="registerForm">
                <label>Email: <input type="email" id="email" value="test@example.com" required></label>
                <label>Password: <input type="password" id="password" value="TestPassword123!" required></label>
                <label>Confirm Password: <input type="password" id="confirmPassword" value="TestPassword123!" required></label>
                <label>Username: <input type="text" id="nick" value="testuser" required></label>
                <label>Nombre: <input type="text" id="name" value="Test" required></label>
                <label>Apellido 1: <input type="text" id="surname1" value="User" required></label>
                <label>Apellido 2: <input type="text" id="surname2" value="Example"></label>
                <label>Fecha Nacimiento: <input type="date" id="birthdate" value="1990-01-01"></label>
                <label>Género: 
                    <select id="gender">
                        <option value="M">Masculino</option>
                        <option value="F">Femenino</option>
                        <option value="O">Otro</option>
                    </select>
                </label>
                <label>País: <input type="text" id="country" value="ES"></label>
                <label>Ciudad: <input type="text" id="city" value="Madrid"></label>
                <label>Código Postal: <input type="text" id="postal_code" value="28001"></label>
                <label>Teléfono: <input type="tel" id="phone" value="+34600000000"></label>
                <br><br>
                <button type="submit">Registrar Usuario</button>
            </form>
            <div id="registerResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="section">
            <h2>2. Test de Confirmación de Email</h2>
            <form id="confirmForm">
                <label>Token de Confirmación: <input type="text" id="confirmToken" placeholder="Pegar token aquí" required></label>
                <br><br>
                <button type="submit">Confirmar Email</button>
            </form>
            <div id="confirmResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="section">
            <h2>3. Test de Login</h2>
            <form id="loginForm">
                <label>Email: <input type="email" id="loginEmail" value="test@example.com" required></label>
                <label>Password: <input type="password" id="loginPassword" value="TestPassword123!" required></label>
                <label><input type="checkbox" id="rememberMe"> Recordarme</label>
                <br><br>
                <button type="submit">Iniciar Sesión</button>
            </form>
            <div id="loginResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="section">
            <h2>4. Test de Reenvío de Confirmación</h2>
            <form id="resendForm">
                <label>Email: <input type="email" id="resendEmail" value="test@example.com" required></label>
                <br><br>
                <button type="submit">Reenviar Confirmación</button>
            </form>
            <div id="resendResult" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        const baseUrl = 'api/Auth';
        
        // Función para mostrar resultado
        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result ' + (isError ? 'error' : 'success');
            element.textContent = JSON.stringify(data, null, 2);
        }
        
        // Función para hacer peticiones
        async function makeRequest(url, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(url, options);
                const result = await response.json();
                
                return { success: response.ok, data: result, status: response.status };
            } catch (error) {
                return { success: false, data: { error: error.message }, status: 0 };
            }
        }
        
        // Test de Registro
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const userData = {
                email: document.getElementById('email').value + Math.floor(Math.random() * 1000), // Hacer email único
                password: document.getElementById('password').value,
                confirmPassword: document.getElementById('confirmPassword').value,
                nick: document.getElementById('nick').value + Math.floor(Math.random() * 1000), // Hacer nick único
                name: document.getElementById('name').value,
                surname1: document.getElementById('surname1').value,
                surname2: document.getElementById('surname2').value,
                birthdate: document.getElementById('birthdate').value,
                gender: document.getElementById('gender').value,
                country: document.getElementById('country').value,
                city: document.getElementById('city').value,
                postal_code: document.getElementById('postal_code').value,
                phone: document.getElementById('phone').value
            };
            
            const result = await makeRequest(baseUrl + '/Register', 'POST', userData);
            showResult('registerResult', result.data, !result.success);
            
            // Si el registro fue exitoso, actualizar campos de login
            if (result.success) {
                document.getElementById('loginEmail').value = userData.email;
                document.getElementById('resendEmail').value = userData.email;
            }
        });
        
        // Test de Confirmación
        document.getElementById('confirmForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const token = document.getElementById('confirmToken').value;
            const result = await makeRequest(baseUrl + '/ConfirmEmail?token=' + encodeURIComponent(token));
            showResult('confirmResult', result.data, !result.success);
        });
        
        // Test de Login
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const loginData = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value,
                remember_me: document.getElementById('rememberMe').checked
            };
            
            const result = await makeRequest(baseUrl + '/Login', 'POST', loginData);
            showResult('loginResult', result.data, !result.success);
        });
        
        // Test de Reenvío
        document.getElementById('resendForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resendData = {
                email: document.getElementById('resendEmail').value
            };
            
            const result = await makeRequest(baseUrl + '/ResendConfirmation', 'POST', resendData);
            showResult('resendResult', result.data, !result.success);
        });
    </script>
</body>
</html>
